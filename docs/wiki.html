<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beyblade Wiki</title>
    <link rel="stylesheet" href="styles.css">
    <script defer src="darkmode.js"></script>
    <script defer src="hamburger.js"></script>
</head>
<body>

<header>
    <a href="index.html" class="header-link">
        <h1>Beyblade Wiki</h1>
    </a>
    <nav>
        <a href="index.html" class="home-icon" aria-label="Home">üè†</a>
        <label class="theme-switch" aria-label="Toggle dark mode">
            <input type="checkbox" id="darkToggle">
            <span class="theme-slider"></span>
        </label>
        <button class="hamburger" id="hamburger" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <div class="nav-menu" id="navMenu">
            <a href="wiki.html">Wiki</a>
            <a href="plots.html">Plots</a>
            <a href="leaderboard.html">Leaderboard</a>
            <a href="matches.html">Matches</a>
        </div>
    </nav>
</header>

<main>
    <h2>Beyblade Encyclopedia</h2>
    
    <div class="wiki-controls">
        <div class="search-container">
            <input type="text" id="wikiSearch" placeholder="Search beyblades...">
        </div>
        
        <div class="filter-section">
            <h4 class="filter-section-title">Type</h4>
            <div class="filter-container">
                <button class="filter-btn active" data-filter-type="type" data-value="all">All</button>
                <button class="filter-btn" data-filter-type="type" data-value="Attack">Attack</button>
                <button class="filter-btn" data-filter-type="type" data-value="Defense">Defense</button>
                <button class="filter-btn" data-filter-type="type" data-value="Stamina">Stamina</button>
                <button class="filter-btn" data-filter-type="type" data-value="Balance">Balance</button>
            </div>
        </div>

        <div class="filter-section">
            <h4 class="filter-section-title">System Line</h4>
            <div class="filter-container">
                <button class="filter-btn active" data-filter-type="system" data-value="all">All</button>
                <button class="filter-btn" data-filter-type="system" data-value="BX">Basic Line</button>
                <button class="filter-btn" data-filter-type="system" data-value="UX">Unique Line</button>
                <button class="filter-btn" data-filter-type="system" data-value="CX">Custom Line</button>
            </div>
        </div>

        <div class="filter-section">
            <h4 class="filter-section-title">Ratchet</h4>
            <div class="filter-container" id="ratchetFilters">
                <button class="filter-btn active" data-filter-type="ratchet" data-value="all">All</button>
            </div>
        </div>

        <div class="filter-section">
            <h4 class="filter-section-title">Bit</h4>
            <div class="filter-container" id="bitFilters">
                <button class="filter-btn active" data-filter-type="bit" data-value="all">All</button>
            </div>
        </div>
    </div>

    <div id="beyCount" class="bey-count"></div>

    <div id="wikiGrid" class="wiki-grid">
        <!-- Beyblade cards will be dynamically loaded here -->
    </div>
</main>

<footer>
    <p>¬© 2025 suptower</p>
</footer>

<script>
let beysData = [];
let filteredBeys = [];
let activeFilters = {
    type: 'all',
    system: 'all',
    ratchet: 'all',
    bit: 'all'
};

// Load beyblade data
fetch('data/beys_data.json')
    .then(response => response.json())
    .then(data => {
        beysData = data;
        filteredBeys = [...beysData];
        populateDynamicFilters();
        applyFilters();
    })
    .catch(error => {
        console.error('Error loading beyblade data:', error);
        document.getElementById('wikiGrid').innerHTML = 
            '<p style="text-align: center; color: var(--text-light);">Failed to load beyblade data.</p>';
    });

// Populate dynamic filters for ratchets and bits
function populateDynamicFilters() {
    const ratchets = new Set();
    const bits = new Set();
    
    beysData.forEach(bey => {
        if (bey.ratchet) ratchets.add(bey.ratchet);
        if (bey.bit) bits.add(bey.bit);
        if (bey.ratchet_integrated_bit) bits.add(bey.ratchet_integrated_bit);
    });
    
    // Sort and add ratchet filters
    const ratchetContainer = document.getElementById('ratchetFilters');
    Array.from(ratchets).sort().forEach(ratchet => {
        const btn = document.createElement('button');
        btn.className = 'filter-btn';
        btn.dataset.filterType = 'ratchet';
        btn.dataset.value = ratchet;
        btn.textContent = ratchet;
        ratchetContainer.appendChild(btn);
    });
    
    // Sort and add bit filters
    const bitContainer = document.getElementById('bitFilters');
    Array.from(bits).sort().forEach(bit => {
        const btn = document.createElement('button');
        btn.className = 'filter-btn';
        btn.dataset.filterType = 'bit';
        btn.dataset.value = bit;
        btn.textContent = bit;
        bitContainer.appendChild(btn);
    });
}

// Render beyblade cards
function renderBeys() {
    const grid = document.getElementById('wikiGrid');
    
    if (filteredBeys.length === 0) {
        grid.innerHTML = '<p style="text-align: center; color: var(--text-light); grid-column: 1 / -1;">No beyblades found.</p>';
        return;
    }
    
    grid.innerHTML = filteredBeys.map(bey => {
        // Determine line class based on code prefix
        let lineClass = '';
        if (bey.code) {
            if (bey.code.startsWith('BX')) lineClass = 'basic-line';
            else if (bey.code.startsWith('UX')) lineClass = 'unique-line';
            else if (bey.code.startsWith('CX')) lineClass = 'custom-line';
        }
        
        return `
        <div class="wiki-card" data-type="${bey.type}">
            <div class="wiki-card-image">
                <img src="${bey.image}" alt="${bey.name}" loading="lazy">
                <div class="wiki-card-type ${bey.type.toLowerCase()}">${bey.type}</div>
            </div>
            <div class="wiki-card-content">
                <h3 class="wiki-card-title">${bey.name}</h3>
                ${bey.code ? `<p class="wiki-card-code ${lineClass}">${bey.code}</p>` : ''}
                <p class="wiki-card-description">${bey.description}</p>
                <div class="wiki-card-parts">
                    <div class="part-item">
                        <span class="part-label">Blade:</span>
                        <span class="part-value">${bey.blade}</span>
                    </div>
                    ${bey.assist_blade ? `
                    <div class="part-item">
                        <span class="part-label">Assist Blade:</span>
                        <span class="part-value">${bey.assist_blade}</span>
                    </div>
                    ` : ''}
                    ${bey.ratchet_integrated_bit ? `
                    <div class="part-item">
                        <span class="part-label">Ratchet Integrated Bit:</span>
                        <span class="part-value">${bey.ratchet_integrated_bit}</span>
                    </div>
                    ` : ''}
                    ${bey.ratchet && !bey.ratchet_integrated_bit ? `
                    <div class="part-item">
                        <span class="part-label">Ratchet:</span>
                        <span class="part-value">${bey.ratchet}</span>
                    </div>
                    ` : ''}
                    ${bey.bit && !bey.ratchet_integrated_bit ? `
                    <div class="part-item">
                        <span class="part-label">Bit:</span>
                        <span class="part-value">${bey.bit}</span>
                    </div>
                    ` : ''}
                </div>
            </div>
        </div>
        `;
    }).join('');
}

// Update count display
function updateCount() {
    const countEl = document.getElementById('beyCount');
    countEl.textContent = `Showing ${filteredBeys.length} of ${beysData.length} beyblades`;
}

// Apply filters to beyblade list
function applyFilters() {
    const searchTerm = document.getElementById('wikiSearch').value.toLowerCase();
    
    filteredBeys = beysData.filter(bey => {
        // Search filter
        const matchesSearch = bey.name.toLowerCase().includes(searchTerm) ||
                            bey.blade.toLowerCase().includes(searchTerm) ||
                            bey.description.toLowerCase().includes(searchTerm) ||
                            (bey.code && bey.code.toLowerCase().includes(searchTerm));
        
        // Type filter
        const matchesType = activeFilters.type === 'all' || bey.type === activeFilters.type;
        
        // System line filter
        let matchesSystem = true;
        if (activeFilters.system !== 'all') {
            matchesSystem = bey.code && bey.code.startsWith(activeFilters.system);
        }
        
        // Ratchet filter
        let matchesRatchet = true;
        if (activeFilters.ratchet !== 'all') {
            matchesRatchet = bey.ratchet === activeFilters.ratchet;
        }
        
        // Bit filter
        let matchesBit = true;
        if (activeFilters.bit !== 'all') {
            matchesBit = bey.bit === activeFilters.bit || bey.ratchet_integrated_bit === activeFilters.bit;
        }
        
        return matchesSearch && matchesType && matchesSystem && matchesRatchet && matchesBit;
    });
    
    // Sort the filtered results by code
    filteredBeys.sort((a, b) => {
        const codeA = a.code || '';
        const codeB = b.code || '';
        return codeA.localeCompare(codeB);
    });
    
    renderBeys();
    updateCount();
}

// Search functionality
document.getElementById('wikiSearch').addEventListener('input', applyFilters);

// Filter functionality - use event delegation on document
document.addEventListener('click', (e) => {
    if (e.target.classList.contains('filter-btn')) {
        const filterType = e.target.dataset.filterType;
        const value = e.target.dataset.value;
        
        if (filterType) {
            // Update active state within the same filter type
            const sameTypeButtons = document.querySelectorAll(`[data-filter-type="${filterType}"]`);
            sameTypeButtons.forEach(btn => btn.classList.remove('active'));
            e.target.classList.add('active');
            
            // Update active filters
            activeFilters[filterType] = value;
            applyFilters();
        }
    }
});

// Hamburger menu functionality
const hamburger = document.getElementById('hamburger');
const navMenu = document.getElementById('navMenu');

if (hamburger && navMenu) {
    hamburger.addEventListener('click', () => {
        hamburger.classList.toggle('active');
        navMenu.classList.toggle('active');
    });

    // Close menu when clicking outside
    document.addEventListener('click', (e) => {
        if (!hamburger.contains(e.target) && !navMenu.contains(e.target)) {
            hamburger.classList.remove('active');
            navMenu.classList.remove('active');
        }
    });

    // Close menu when clicking a link
    navMenu.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
            hamburger.classList.remove('active');
            navMenu.classList.remove('active');
        });
    });
}
</script>

</body>
</html>
