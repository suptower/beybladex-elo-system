<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galerie</title>

    <link rel="stylesheet" href="styles.css">

    <script defer src="darkmode.js"></script>
    <script defer src="viewer.js"></script>
    <script defer src="hamburger.js"></script>

</head>
<body>

<header>
    <h1>Gallery</h1>
    <nav>
        <label class="theme-switch" aria-label="Toggle dark mode">
            <input type="checkbox" id="darkToggle">
            <span class="theme-slider"></span>
        </label>
        <button class="hamburger" id="hamburger" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <div class="nav-menu" id="navMenu">
            <a href="index.html" aria-label="Home">üè†</a>
            <a href="wiki.html">Wiki</a>
            <a href="plots.html">Plots</a>
            <a href="leaderboard.html">Leaderboard</a>
        </div>
    </nav>
</header>

<main>
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Suche nach Beys">
    </div>
    <div id="gallery" class="gallery"></div>
</main>

<footer>
    <p>¬© 2025 suptower</p>
</footer>

<script>
const paths = {
    bars: "./plots/bars/plots.json",
    elo: "./plots/elo/plots.json",
    positions: "./plots/positions/plots.json",
    heatmaps: "./plots/heatmaps/plots.json",
    single: "./plots/plots.json"
};

const titles = {
    bars: "Winrate & ELO Balkendiagramme",
    elo: "ELO-Verl√§ufe",
    positions: "Positionsverl√§ufe",
    heatmaps: "Heatmaps",
    single: "Kombinierte Plots"
};

const params = new URLSearchParams(window.location.search);
const type = params.get("type") || "single";

// only show search bar for position and elo
document.addEventListener("DOMContentLoaded", () => {
    if (type === "elo" || type === "positions") {
        document.querySelector(".search-container").style.display = "block";
    } else {
        document.querySelector(".search-container").style.display = "none";
    }
});

const titleElem = document.getElementById("title");
if (titleElem) {
    titleElem.textContent = titles[type];
}


let allImages = [];
let currentImages = [];

// Function to get appropriate image based on dark mode
function getImageSrc(base, filename) {
    const isDark = document.body.classList.contains('dark');
    const darkFilename = filename.replace('.png', '_dark.png');
    
    if (isDark && type !== 'single') {
        // For subdirectories, dark mode images are in a 'dark' subfolder
        return base + 'dark/' + darkFilename;
    } else if (isDark && type === 'single') {
        // For root level plots, dark images are in 'dark/' folder
        return './plots/dark/' + darkFilename;
    }
    return base + filename;
}

fetch(paths[type])
    .then(res => res.json())
    .then(files => {
        const base = paths[type].replace("plots.json", "");
        
        allImages = files.map(f => ({
            filename: f,
            title: f.replace(/\.(png|jpg|jpeg)$/i, '').replace(/_position$/i, '')
        }));
        
        currentImages = [...allImages];
        renderGallery(currentImages);
        
        // Setup search
        const searchInput = document.getElementById("searchInput");
        searchInput.addEventListener("input", e => {
            const query = e.target.value.toLowerCase();
            currentImages = allImages.filter(img => 
                img.title.toLowerCase().includes(query)
            );
            renderGallery(currentImages);
        });
        
        // Re-render gallery when dark mode changes
        const observer = new MutationObserver(() => {
            renderGallery(currentImages);
        });
        observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });
    });

function renderGallery(images) {
    const gallery = document.getElementById("gallery");
    gallery.innerHTML = "";
    const base = paths[type].replace("plots.json", "");
    
    images.forEach((imgObj, index) => {
        const img = document.createElement("img");
        img.src = getImageSrc(base, imgObj.filename);
        img.alt = imgObj.title;
        img.onclick = () => {
            // Create viewer images array with proper src based on current mode
            const viewerImgs = currentImages.map(i => ({
                src: getImageSrc(base, i.filename),
                title: i.title
            }));
            openViewer(index, viewerImgs);
        };
        gallery.appendChild(img);
    });
}
</script>

</body>
</html>
